[{"title":"Hexo基于fluid模板的相册搭建","url":"/2024/03/25/Hexo基于fluid主题的相册搭建/","content":"\n\nHexo主要是用于发表博客也就是文章的静态网页框架工具，所以官方很少给到相册搭建的教程。而作为前端小白的我，尝试搭建网页的目的就是为了制作一个网页相册，为此，我死磕了接近一个星期，才大概把这个博客网页集成相册功能的方法搞懂。\n\n# Toc\n<!-- @import \"[TOC]\" {cmd=\"toc\" depthFrom=2 depthTo=3 orderedList=false} -->\n\n<!-- code_chunk_output -->\n\n- [搭建思路](#搭建思路)\n- [文件夹分配](#文件夹分配)\n- [操作步骤](#操作步骤)\n  - [1.新建相册页面](#1新建相册页面)\n  - [2.处理图片信息](#2处理图片信息)\n  - [3.加载js和css文件](#3加载js和css文件)\n  - [4.网页端图片加速](#4网页端图片加速)\n- [优化](#优化)\n  - [简化create流程](#简化create流程)\n  - [简化ossutil流程](#简化ossutil流程)\n- [参考](#参考)\n\n<!-- /code_chunk_output -->\n\n\n\n## 搭建思路\n\n![搭建思路](https://picoflynx.oss-cn-guangzhou.aliyuncs.com/source/images/gallery/%E6%96%87%E7%AB%A0%E5%9B%BE/202403302122803.png)\n\n## 文件夹分配\n\n![文件夹结构](https://picoflynx.oss-cn-guangzhou.aliyuncs.com/source/images/gallery/%E6%96%87%E7%AB%A0%E5%9B%BE/202403311642349.png)\n\n- gallery：装载相册原图的文件夹。在该文件夹下，不同主题的相册以**单独**的文件夹存放，并且，相册里面只允许存放**图片格式**的文件\n- photos：由hexo新建命令生成的页面文件夹，用于构成网页导航中的相册子页面。其中的**index**定义了页面的内容和元数据（通过YAML Front-matter），并会被Hexo转换成最终的静态HTML页面\n- js：存放source文件下的JavaScript脚本\n- hexo根目录下的scripts：存放注入代码等需要在根目录执行的JavaScript脚本\n\n## 操作步骤\n\n### 1.新建相册页面\n\n```node\nhexo n page photos\n```\n\n编辑index.md,输入以下信息形成页面布局\n\n```markdown\n---\ntitle: Photos\ndate: 2024-03-25 16:57:45\nsubtitle: 岁月留痕\nlayout: photo\n---\n\n<style>\n.ImageGrid {\n  width: 100%;\n  max-width: 1040px;\n  margin: 0 auto;\n  text-align: center;\n}\n.card {\n  overflow: hidden;\n  transition: .3s ease-in-out;\n  border-radius: 8px;\n  background-color: #efefef;\n  padding: 1.4px;\n}\n.ImageInCard img {\n  padding: 0;\n  border-radius: 8px;\n  width:100%;\n  height:100%;\n}\n@media (prefers-color-scheme: dark) {\n  .card {background-color: rgba(180,180,180,0.2)#333;}\n}\n\n</style>\n<div id=\"imageTab\"></div>\n<div class=\"ImageGrid\"></div>\n```\n\n### 2.处理图片信息\n\n1. 创建存放照片原图文件夹images/gallery，子目录为根据主题分类的相册，如“广州”、“上海”...\n\n2. 在gallery文件夹下新建js文件\"create.js\"，用于处理图片信息\n\n   ```js\n   # create.js\n   const fs = require('fs-extra');\n   const path = require('path');\n   const imageSize = require('image-size');  # 这里没有安装 image-size，需要npm安装下:   npm i -S image-size\n   \n   const rootPath=\"gallery/\"   //相册相对路径，也可填绝对路径，指向相册的目录，目的为了生成json\n   \n   class PhotoExtension {\n       constructor() {\n           this.size = 64;\n           this.offset = [0, 0];\n       }\n   }\n   \n   class Photo {\n       constructor() {\n           this.dirName = '';\n           this.fileName = '';\n           this.iconID = '';\n           this.extension = new PhotoExtension();\n       }\n   }\n   \n   class PhotoGroup {\n       constructor() {\n           this.name = '';\n           this.children = [];\n       }\n   }\n   \n   function createPlotIconsData() {\n       let allPlots = [];\n       let allPlotGroups = [];\n   \n       const plotJsonFile = path.join(__dirname, './photosInfo.json');\n       const plotGroupJsonFile = path.join(__dirname, './photos.json');\n   \n       if (fs.existsSync(plotJsonFile)) {\n           allPlots = JSON.parse(fs.readFileSync(plotJsonFile));\n       }\n   \n       if (fs.existsSync(plotGroupJsonFile)) {\n           allPlotGroups = JSON.parse(fs.readFileSync(plotGroupJsonFile));\n       }\n   \n       fs.readdirSync(__dirname).forEach(function(dirName) {\n           const stats = fs.statSync(path.join(__dirname, dirName));\n           const isDir = stats.isDirectory();\n           if (isDir) {\n               const subfiles = fs.readdirSync(path.join(__dirname, dirName));\n               subfiles.forEach(function(subfileName) {\n                   // 如果已经存在 则不再处理\n                   // if (allPlots.find(o => o.fileName === subfileName && o.dirName === dirName)) {\n                   //     return;\n                   // }\n   \n                   // 新增标\n                   const plot = new Photo();\n                   plot.dirName = dirName;\n                   plot.fileName = subfileName;\n                   const imageInfo = imageSize(rootPath+dirName + \"/\" + subfileName);\n                   plot.iconID = imageInfo.width + '.' + imageInfo.height + ' ' + subfileName;\n                   allPlots.push(plot);\n                   console.log(`RD: createPlotIconsData -> new plot`, plot);\n   \n                   // 为新增标添加分组 暂时以它所处的文件夹为分组\n                   let group = allPlotGroups.find(o => o.name === dirName);\n                   if (!group) {\n                       group = new PhotoGroup();\n                       group.name = dirName;\n                       allPlotGroups.push(group);\n                       console.log(`RD: createPlotIconsData -> new group`, group);\n                   }\n                   group.children.push(plot.iconID);\n               });\n           }\n       });\n   \n       fs.writeJSONSync(plotJsonFile, allPlots);\n       fs.writeJSONSync(plotGroupJsonFile, allPlotGroups);\n   }\n   \n   createPlotIconsData();\n   ```\n\n3. **执行create.js文件**，在gallery文件夹下生成包含图片信息的JSON文件（photosInfo.json和photos.json`）\n\n   ```cmd\n   # 相册的生成需要先用create.js脚本对images\\gallery\\下的相册文件进行预处理\n   # 示例 F:myblog\\source\\images>node gallery/create.js\n   node gallery/create.js\n   ```\n\n4. 将photos.json**拷贝**到source目录下的photos页面文件夹中\n\n### 3.加载js和css文件\n\n1. 在 /source/js/ 目录下创建 photoWall.js，用于在网页上动态创建和管理图片相册的界面\n\n   ```js\n   var imgDataPath = \"/photos/photos.json\"; //图片名称高宽信息json文件路径\n   var imgPath = \"/sources/images/gallery/\"; //图片访问路径, 这里示例是本地路径，后续会提供网页端图片加载加速方案\n   var imgMaxNum = 50; //图片显示数量\n   \n   var windowWidth =\n     window.innerWidth ||\n     document.documentElement.clientWidth ||\n     document.body.clientWidth;\n   if (windowWidth < 768) {\n     var imageWidth = 145; //图片显示宽度(手机端)\n   } else {\n     var imageWidth = 250; //图片显示宽度\n   }\n   \n   const photo = {\n     page: 1,\n     offset: imgMaxNum,\n     init: function () {\n       var that = this;\n       $.getJSON(imgDataPath, function (data) {\n         that.render(that.page, data);\n         //that.scroll(data);\n         that.eventListen(data);\n       });\n     },\n     constructHtml(options) {\n       const {\n         imageWidth,\n         imageX,\n         imageY,\n         name,\n         imgPath,\n         imgName,\n         imgNameWithPattern,\n       } = options;\n       const htmlEle = `<div class=\"card lozad\" style=\"width:${imageWidth}px\">\n                     <div class=\"ImageInCard\" style=\"height:${\n                       (imageWidth * imageY) / imageX\n                     }px\">\n                       <a data-fancybox=\"gallery\" href=\"${imgPath}${name}/${imgNameWithPattern}\"\n                             data-caption=\"${imgName}\" title=\"${imgName}\">\n                               <img  class=\"lazyload\" data-src=\"${imgPath}${name}/${imgNameWithPattern}\"\n                               src=\"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"\n                               onload=\"lzld(this)\"\n                               lazyload=\"auto\">\n                           </a>\n                     </div>\n                   </div>`;\n       return htmlEle;\n     },\n     render: function (page, data = []) {\n       this.data = data;\n       if (!data.length) return;\n       var html,\n         imgNameWithPattern,\n         imgName,\n         imageSize,\n         imageX,\n         imageY,\n         li = \"\";\n   \n       let liHtml = \"\";\n       let contentHtml = \"\";\n   \n       data.forEach((item, index) => {\n         const activeClass = index === 0 ? \"active\" : \"\";\n         liHtml += `<li class=\"nav-item\" role=\"presentation\">\n             <a class=\"nav-link ${activeClass} photo-tab\" id=\"home-tab\" photo-uuid=\"${item.name}\" data-toggle=\"tab\" href=\"#${item.name}\"  role=\"tab\" aria-controls=\"${item.name}\" aria-selected=\"true\">${item.name}</a>\n           </li>`;\n       });\n       const [initData = {}] = data;\n       const { children = [],name } = initData;\n       children.forEach((item, index) => {\n         imgNameWithPattern = item.split(\" \")[1];\n         imgName = imgNameWithPattern.split(\".\")[0];\n         imageSize = item.split(\" \")[0];\n         imageX = imageSize.split(\".\")[0];\n         imageY = imageSize.split(\".\")[1];\n         let imgOptions = {\n           imageWidth,\n           imageX,\n           imageY,\n           name,\n           imgName,\n           imgPath,\n           imgNameWithPattern,\n         };\n         li += this.constructHtml(imgOptions);\n       });\n       contentHtml += ` <div class=\"tab-pane fade show active\"  role=\"tabpanel\" aria-labelledby=\"home-tab\">${li}</div>`;\n   \n       const ulHtml = `<ul class=\"nav nav-tabs\" id=\"myTab\" role=\"tablist\">${liHtml}</ul>`;\n       const tabContent = `<div class=\"tab-content\" id=\"myTabContent\">${contentHtml}</div>`;\n   \n       $(\"#imageTab\").append(ulHtml);\n       $(\".ImageGrid\").append(tabContent);\n       this.minigrid();\n     },\n     eventListen: function (data) {\n       let self = this;\n       var html,\n         imgNameWithPattern,\n         imgName,\n         imageSize,\n         imageX,\n         imageY,\n         li = \"\";\n       $('a[data-toggle=\"tab\"]').on(\"shown.bs.tab\", function (e) {\n         $(\".ImageGrid\").empty();\n         const selectId = $(e.target).attr(\"photo-uuid\");\n         const selectedData = data.find((data) => data.name === selectId) || {};\n         const { children,name } = selectedData;\n         let li = \"\";\n         children.forEach((item, index) => {\n           imgNameWithPattern = item.split(\" \")[1];\n           imgName = imgNameWithPattern.split(\".\")[0];\n           imageSize = item.split(\" \")[0];\n           imageX = imageSize.split(\".\")[0];\n           imageY = imageSize.split(\".\")[1];\n           let imgOptions = {\n             imageWidth,\n             imageX,\n             imageY,\n             name,\n             imgName,\n             imgPath,\n             imgNameWithPattern,\n           };\n           li += self.constructHtml(imgOptions);\n         });\n         $(\".ImageGrid\").append(li);\n         self.minigrid();\n       });\n     },\n     minigrid: function () {\n       var grid = new Minigrid({\n         container: \".ImageGrid\",\n         item: \".card\",\n         gutter: 12,\n       });\n       grid.mount();\n       $(window).resize(function () {\n         grid.mount();\n       });\n     },\n   };\n   photo.init();\n   ```\n\n2. 使用注册器将需要的js,css注入,在/scripts/injector.js(如没有,则创建)中输入以下内容:\n\n   ```js\n   const { root: siteRoot = \"/\" } = hexo.config;\n   // layout为photo的时候导入这些js与css\n   hexo.extend.injector.register(\n     \"body_end\",\n     `\n     <link rel=\"stylesheet\" href=\"https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css\">\n     <script src=\"//cdn.jsdelivr.net/npm/minigrid@3.1.1/dist/minigrid.min.js\"></script>\n     <script src=\"https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js\"></script>\n    <script src=\"https://cdn.bootcdn.net/ajax/libs/lazyloadjs/3.2.2/lazyload.js\"></script>\n       <script defer src=\"${siteRoot}js/photoWall.js\"></script>`,\n     \"photo\"\n   );\n   ```\n\n### 4.网页端图片加速\n\n​\t因为我是基于githubpage部署的博客，国内访问的时候，图片文件加载起来巨慢从而导致导致网页基本打不开，刚开始我参考[如何使用jsDelivr+Github 实现免费CDN加速?](https://zhuanlan.zhihu.com/p/346643522)搭建了一个github仓库用于存放相册并用于cdn加速，但实际效果还是不行，因此，我想到了用阿里云oss图床，提高网页中图片加载速度，从而提高网页加载速度。\n\n1. 文章中图片：采用typora+picgo+阿里云oss方案，参考链接：[【Typora】typora+picgo+阿里云oss搭建图床](https://www.cnblogs.com/myworld7/p/13132549.html)。\n\n2. 相册图片：阿里云ossutil工具，具体方法参考官方说明：[ossutil概述](https://help.aliyun.com/zh/oss/developer-reference/overview-59?spm=5176.8465980.help.dexternal.9c691450trHl8S)。\n\n   - 如果使用该方案photowall.js中的图片访问路径（imgPath）需更改为阿里云文件夹中的前缀。如“<https://picoflynx.oss-cn-XXX.aliyuncs.com/source/images/gallery/”>\n   - 为了实现相对于photowall.js图片访问路径与本地相册路径的一致性，我把整个source文件都上传至oss了\n\n   至此，一个基于hexo的fluid主题的相册就搭建完成啦~，效果如图：\n\n   ![相册效果图](https://picoflynx.oss-cn-guangzhou.aliyuncs.com/source/images/gallery/%E6%96%87%E7%AB%A0%E5%9B%BE/202403302209080.png)\n\n## 优化\n\n### 简化create流程\n\n​\t每次上传图片的时候，都需要删除photos.json，再重新执行create.js生成新的photos.json，然后再复制到photos页面文件夹...太麻烦了\n\n**解决方案**：写bat脚本执行这个过程（本人技术有限，只想到了这个...）\n\n- 先写一个批处理文件（run-node-app.bat)置于image文件夹，用于删除旧photos.json,并执行create.js\n\n  ```bat\n  @echo off\n  cd /d \"F:myblog\\source\\images\"\n  \n  :: 定义要删除的子文件夹中的文件路径\n  SET \"FILE_PATH_1=gallery\\photos.json\"\n  SET \"FILE_PATH_2=gallery\\photosInfo.json\"\n  \n  :: 删除第一个文件\n  del \"%FILE_PATH_1%\" 2>nul\n  if not exist \"%FILE_PATH_1%\" (\n      echo The file %FILE_PATH_1% has been deleted successfully.\n  ) else (\n      echo The file %FILE_PATH_1% was not found or could not be deleted.\n  )\n  \n  :: 删除第二个文件\n  del \"%FILE_PATH_2%\" 2>nul\n  if not exist \"%FILE_PATH_2%\" (\n      echo The file %FILE_PATH_2% has been deleted successfully.\n  ) else (\n      echo The file %FILE_PATH_2% was not found or could not be deleted.\n  )\n  \n  :: 执行create.js\n  node \"gallery\\create.js\"\n  \n  pause\n  ```\n\n- 在source文件夹下写一个批处理文件（img-refresh.bat)，用于调用run-node-app.bat,并覆盖photos/photos.js\n\n  ```bat\n  @echo off\n  :: 处理相册gallery\n  cd /d \"F:myblog\\source\\images\"\n  call \"run-node-app.bat\"\n  echo \"run-node-app.bat has been executed.\"\n  \n  pause\n  \n  ::复制粘贴至photos\n  \n  cd /d \"F:myblog\\source\"\n  \n  :: 定义要删除的photos中的文件路径\n  SET \"FILE_PATH_1=photos\\photos.json\"\n  \n  :: 定义要复制的文件路径和目标路径\n  SET \"SOURCE_FILE_PATH=images\\gallery\\photos.json\"\n  SET \"TARGET_FILE_PATH=photos\\photos.json\"\n  \n  :: 删除子文件夹photos中的一个文件\n  del \"%FILE_PATH_1%\" 2>nul\n  if not exist \"%FILE_PATH_1%\" (\n      echo The file %FILE_PATH_1% has been deleted successfully.\n  ) else (\n      echo The file %FILE_PATH_1% was not found or could not be deleted.\n  )\n  \n  :: 将images/gallery/中的文件复制到photos中\n  copy \"%SOURCE_FILE_PATH%\" \"%TARGET_FILE_PATH%\" /y\n  if not exist \"%TARGET_FILE_PATH%\" (\n      echo Failed to copy the file from subfolder1 to subfolder2.\n      goto End\n  ) else (\n      echo The file has been copied successfully from subfolder1 to subfolder2.\n  )\n  \n  pause\n  ```\n\n- 该法方法脚本编写过程可能有点低级，但最终实现的效果是，只需要在相册更新之后，双击一下img-refresh.bat就能实现相册更新了\n\n### 简化ossutil流程\n\n**痛点**：ossutil命令太难用了，搞了好久都没明白怎么实现命令简化\n\n**解决方案**：那就又bat吧。编写一个bat(osssync.bat)置于image文件夹下，用于一键同步本地相册于oss\n\n```bat\n@echo off\n\nossutil64 sync F:myblog\\source\\images oss://bucket名/source/images/ --force\n:: --force为可选项，当使用ossutil64 sync命令同步文件夹到阿里云OSS时，确实会提示你确认每个文件的上传操作。为了简化这个过程，避免每次上传时都需要手动输入确认（y/n），在命令行中添加--force选项。让ossutil在同步时自动覆盖目标OSS上的文件，而不需要进一步的确认。\n\npause\n```\n\n## 参考\n\n1. [【Hexo】基于Fluid主题的Hexo增加相册功能实践 | Kezade](https://zyxelva.github.io/posts/45280.html#3-加载-js和css文件)\n\n2. [如何使用jsDelivr+Github 实现免费CDN加速? - 知乎](https://zhuanlan.zhihu.com/p/346643522)\n\n3. [【Hexo】基于Fluid主题的Hexo增加相册功能实践](https://zyxelva.github.io/posts/45280.html#3-%E5%8A%A0%E8%BD%BD-js%E5%92%8Ccss%E6%96%87%E4%BB%B6)\n","tags":["网页搭建"],"categories":["生产指南"]},{"title":"欢迎来到晓老板之家","url":"/2024/03/25/First post/","content":" Welcome! This is my first blog, going forward I'll be documenting my studies and life here, thanks for following ~\n"},{"title":"《如何找到想做的事》","url":"/2024/03/25/寻找人生之路/","content":"\n# 人生道路的选择\n\n## Step 1. 了解自己\n\n### 价值观（原则和标准）\n\n|                           Question                           | Answer |\n| :----------------------------------------------------------: | :----: |\n| 你有尊敬的人吗？他是谁？<br />为什么尊敬他？为什么崇拜他？喜欢他什么地方？ |        |\n|           青春期或活力期是否有你我影响很大的事情？           |        |\n|                现在社会有什么需要改进的地方？                |        |\n|             在朋友眼里你是一个看重什么东西的人？             |        |\n|        你会给别人什么建议？或不希望别人给你什么建议？        |        |\n\n### 天赋与才能（你的说明书）\n\n|             Question             | Answer |\n| :------------------------------: | ------ |\n|       目前人生最充实的经历       |        |\n|    最近一次对别人不耐烦的事情    |        |\n|      闻身边的人你擅长什么？      |        |\n| 放弃现在的工作，特别想做的事情？ |        |\n|       目前为止成功的事情？       |        |\n\n### 愿望和梦想\n\n|           Question           | Answer |\n| :--------------------------: | ------ |\n| 什么事情就算花钱也愿意去学？ |        |\n|   你书架上有什么类型的书？   |        |\n| 有没有什么内容给你很大帮助?  |        |\n|   你有想要感谢的人和事吗？   |        |\n|  你对这世界有什么不满的吗？  |        |\n\n## Step 2. 做出人生道路选择\n\n### 判断可能的人生方向\n\n![](https://picoflynx.oss-cn-guangzhou.aliyuncs.com/img/post/202403262040152.png)\n\n* 注意：\n  1. 最终选择要符合价值观\n  2. 这一次选择不会是人生的最后一次选择\n","tags":["成长"]}]